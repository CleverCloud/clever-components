import{s as t}from"./i18n-bf531c19.js";import"./cc-toggle-8b8e589e.js";import"./cc-map-marker-dot-948bbfc4.js";import"./cc-map-c3cd5dae.js";import{L as e,h as o,d as i,c as a}from"./vendor-5e139a4e.js";class r extends e{static get properties(){return{appName:{type:String,attribute:"app-name"},centerLat:{type:Number,attribute:"center-lat"},centerLon:{type:Number,attribute:"center-lon"},error:{type:Boolean,reflect:!0},heatmapPoints:{type:Array,attribute:"heatmap-points"},loading:{type:Boolean,reflect:!0},mode:{type:String},orgaName:{type:String,attribute:"orga-name"},viewZoom:{type:Number,attribute:"view-zoom"},_points:{type:Array}}}constructor(){super(),this.centerLat=48.9,this.centerLon=2.4,this.error=!1,this.loading=!1,this.mode="points",this.viewZoom=2,this._points=[],this._pointsByCoords={}}addPoints(t,e={}){const{spreadDuration:o=!1}=e,i=!1!==o?Math.floor(o/t.length):0;t.forEach(((t,e)=>{setTimeout((()=>this._addPoint(t)),i*e)}))}_addPoint({lat:t,lon:e,count:o=1,delay:i=1e3,tooltip:a}){const r=[t,e].join(","),s={lat:t,lon:e,count:o,tooltip:a};null==this._pointsByCoords[r]&&(this._pointsByCoords[r]=[]),this._pointsByCoords[r].push(s),this._updatePoints(),setTimeout((()=>{this._pointsByCoords[r]=this._pointsByCoords[r].filter((t=>t!==s)),0===this._pointsByCoords[r].length&&delete this._pointsByCoords[r],this._updatePoints()}),i)}_updatePoints(){this._points=Object.entries(this._pointsByCoords).map((([t,e])=>{const{lat:o,lon:i}=e[0],a=e.map((t=>t.count)).reduce(((t,e)=>t+e),0),r=e.filter((t=>null!=t.tooltip&&""!==t.tooltip)).map((t=>t.tooltip)),s=Array.from(new Set(r));s.length>=3&&(s.length=3,s[2]=s[2]+"...");return{lat:o,lon:i,marker:{tag:"cc-map-marker-dot",count:a},tooltip:s.length>0?s.join("<br>"):null}}))}_getModes(){return[{label:"Realtime",value:"points"},{label:"Last 24h",value:"heatmap"}]}_getLegend(){return"points"===this.mode?null==this.appName?(({orgaName:e})=>t`Realtime map of HTTP requests received by all apps from <strong>${e}</strong>.`)({orgaName:this.orgaName}):(({appName:e})=>t`Realtime map of HTTP requests received by <strong>${e}</strong>.`)({appName:this.appName}):null==this.appName?(({orgaName:e})=>t`Heatmap of HTTP requests received by all apps from <strong>${e}</strong> during the last 24 hours.`)({orgaName:this.orgaName}):(({appName:e})=>t`Heatmap of HTTP requests received by <strong>${e}</strong> during the last 24 hours.`)({appName:this.appName})}render(){return o`<cc-toggle .choices=${this._getModes()} value=${this.mode} @cc-toggle:input=${this._onModeChange}></cc-toggle><cc-map center-lat=${this.centerLat} center-lon=${this.centerLon} view-zoom=${this.viewZoom} mode=${this.mode} ?loading=${this.loading} ?error=${this.error} .heatmapPoints=${this.heatmapPoints} .points=${this._points}>${this._getLegend()}</cc-map>`}_onModeChange({detail:t}){this.mode=t,i(this,"mode",this.mode)}static get styles(){return a`:host{border:1px solid #ccc;border-radius:.25rem;display:block;height:15rem;overflow:hidden;position:relative;width:20rem}cc-toggle{left:.5rem;position:absolute;top:.5rem;z-index:2}cc-map{height:100%;left:0;position:absolute;top:0;width:100%;z-index:1}cc-map[view-zoom="1"]{--cc-map-marker-dot-size:6px}cc-map[view-zoom="2"]{--cc-map-marker-dot-size:8px}cc-map[view-zoom="3"]{--cc-map-marker-dot-size:10px}cc-map[view-zoom="4"]{--cc-map-marker-dot-size:12px}cc-map[view-zoom="5"]{--cc-map-marker-dot-size:14px}cc-map[view-zoom="6"]{--cc-map-marker-dot-size:16px}`}}window.customElements.define("cc-logsmap",r);export{r as CcLogsMap};
