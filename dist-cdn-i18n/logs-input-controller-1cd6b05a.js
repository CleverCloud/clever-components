import{h as t}from"./dom-ad431943.js";import{E as i}from"./events-4c8e3503.js";import{e as o}from"./shadow-dom-utils-12ce1dad.js";import{c as e}from"./utils-aa566623.js";import{AnimationRunner as s}from"./animation-runner-c805dcec.js";class n{constructor(t){this._host=t,this.onClick=this.onClick.bind(this),this.onClickLog=this.onClickLog.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onMouseDownGutter=this.onMouseDownGutter.bind(this),this._windowMouseMoveHandler=new i(window,"mousemove",(t=>this._onDrag(t))),this._windowMouseUpHandler=new i(window,"mouseup",(t=>this._onDragStop(t))),this._arrowKeysAnimationRunner=new s,this._dragAnimationRunner=new s,this._keyModifiers={ctrl:!1,shift:!1}}onKeyDown(t){if("Escape"===t.key&&this._host._onEscape(),"Control"===t.key||"Meta"===t.key)this._keyModifiers.ctrl=!0;else if("Shift"===t.key)this._keyModifiers.shift=!0;else if("ArrowDown"===t.key||"ArrowUp"===t.key){t.preventDefault();const i="ArrowDown"===t.key?"down":"up";if(this._arrowKeysAnimationRunner.isStopped()){let t=!1;this._arrowKeysAnimationRunner.start(((o,e,s)=>{const n=o===e;t||=o-e>100;return!!(n||t&&o-s>25)&&(this._host._onArrow(i),!0)}))}}else if("c"===t.key&&this._keyModifiers.ctrl)this._host._onCopySelectionToClipboard();else if("Enter"===t.key||" "===t.key){t.preventDefault();const i=Number(t.target.closest(".log").dataset.index);this._host._onClickLog(i,this._keyModifiers)}else"a"===t.key&&this._keyModifiers.ctrl?(t.preventDefault(),this._host._onSelectAll()):"Home"===t.key?this._host._onHome(this._keyModifiers.ctrl&&this._keyModifiers.shift):"End"===t.key&&this._host._onEnd(this._keyModifiers.ctrl&&this._keyModifiers.shift)}onKeyUp(t){"Control"===t.key||"Meta"===t.key?this._keyModifiers.ctrl=!1:"Shift"===t.key?this._keyModifiers.shift=!1:"ArrowDown"!==t.key&&"ArrowUp"!==t.key||this._arrowKeysAnimationRunner.stop()}onClick(t){"stopping"!==this._dragState&&this._host._onClick(t)}onClickLog(t){t.stopPropagation();const i=Number(t.target.closest(".log").dataset.index);this._host._onClickLog(i,this._keyModifiers)}onMouseDownGutter(t){this._windowMouseMoveHandler.connect(),this._windowMouseUpHandler.connect(),this._dragState="init"}_onDrag(i){if(i.ctrlKey||i.shiftKey)return;const o="init"===this._dragState;this._dragState="dragging";const{position:s,distance:n}=this._getCursorPosition(i,this._host);if("inside"===s||"left"===s||"right"===s){this._dragAnimationRunner.stop();const e=this._getElementsFromPoint(i,s,n).find((i=>t(i,"log"))),r=Number(e.dataset.index);this.dragIndex!==r&&(this._host._onDrag({logIndex:r},o),this.dragIndex=r)}if("above"===s||"below"===s){const t="above"===s?"up":"down",i=e(n,1,50);this._dragAnimationPeriodMs=Math.ceil(300-280*i/49),this._dragAnimationLogOffset=Math.ceil(9*i/49),this._dragAnimationRunner.isStopped()&&this._dragAnimationRunner.start(((i,e,s)=>!!(i-s>this._dragAnimationPeriodMs)&&(this._host._onDrag({direction:t,offset:this._dragAnimationLogOffset},o),!0)))}}_onDragStop(t){this._windowMouseMoveHandler.disconnect(),this._windowMouseUpHandler.disconnect(),this._dragAnimationRunner.stop(),this._dragState="stopping",setTimeout((()=>{this._dragState="stopped"}),0)}_getElementsFromPoint(t,i,e){if("inside"===i)return t.composedPath();if("left"===i||"right"===i){const s=t.clientX+("left"===i?1:-1)*(e+this._host.offsetWidth/2),n=t.clientY;return o(s,n)}return[]}_getCursorPosition(t,i){const o=i.offsetWidth,e=i.offsetHeight,s=this._getRelativeCoordinates(t,i);return s.y<0?{position:"above",distance:-s.y}:s.y>e?{position:"below",distance:s.y-e}:s.x<0?{position:"left",distance:-s.x}:s.x>o?{position:"right",distance:s.x-o}:{position:"inside"}}_getRelativeCoordinates(t,i){const o=t.pageX,e=t.pageY,s={left:i.offsetLeft,top:i.offsetTop};let n=i.offsetParent;for(;null!=n;)s.left+=n.offsetLeft,s.top+=n.offsetTop,n=n.offsetParent;return{x:o-s.left,y:e-s.top}}}export{n as LogsInputController};
