import{s as e}from"./i18n-bf531c19.js";import"./cc-button-0fc35634.js";import"./cc-expand-2cca00e2.js";import"./cc-loader-c874b32c.js";import"./cc-toggle-8b8e589e.js";import"./cc-flex-gap-4e6ab5ba.js";import"./cc-error-8d730ec3.js";import"./cc-env-var-editor-expert-2fbc0daf.js";import"./cc-env-var-editor-simple-342f4542.js";import{L as t,d as i,h as r,a,c as s}from"./vendor-5e139a4e.js";import{l as n}from"./cc-link-bb132771.js";class o extends t{static get properties(){return{appName:{type:String,attribute:"app-name"},context:{type:String},error:{type:String,reflect:!0},heading:{type:String,reflect:!0},readonly:{type:Boolean,reflect:!0},restartApp:{type:Boolean,attribute:"restart-app"},saving:{type:Boolean,reflect:!0},variables:{type:Array},_currentVariables:{type:Array,attribute:!1},_description:{type:String,attribute:!1},_expertVariables:{type:Array,attribute:!1},_mode:{type:String,attribute:!1},_isPristine:{type:Boolean,attribute:!1}}}constructor(){super(),this.appName="?",this.readonly=!1,this.restartApp=!1,this.saving=!1,this._mode="SIMPLE",this._description=""}_getModes(){return[{label:"Simple",value:"SIMPLE"},{label:"Expert",value:"EXPERT"}]}_getErrorMessage(){return"loading"===this.error?"Something went wrong while loading variables.":"saving"===this.error?"Something went wrong while updating variables.":"Something went wrong..."}_onChange({detail:e}){const t=this._initVariables.filter((t=>{const i=e.find((e=>e.name===t.name));return(null==i||i.isDeleted)&&!t.isNew})).map((e=>({...e,isDeleted:!0}))),i=e.filter((e=>null==this._initVariables.find((t=>t.name===e.name)))).map((e=>({...e,isNew:!0}))),r=e.filter((e=>{const r=t.find((t=>t.name===e.name)),a=i.find((t=>t.name===e.name));return!r&&!a})).map((e=>{const t=this._initVariables.find((t=>t.name===e.name)).value!==e.value;return{...e,isEdited:t}})),a=[...t,...i,...r];this._isPristine=!a.some((({isDeleted:e,isNew:t,isEdited:i})=>e||t||i)),this._currentVariables=a.sort(((e,t)=>e.name.localeCompare(t.name)))}_onToggleMode({detail:e}){"EXPERT"===e&&(this._expertVariables=this._currentVariables),this._mode=e}_onResetForm(){this.variables=this._initVariables}_onUpdateForm(){const e=this._currentVariables.filter((({isDeleted:e})=>!e)).map((({name:e,value:t})=>({name:e,value:t})));i(this,"submit",e)}_onRequestSubmit(e,t){e.stopPropagation(),t||this._onUpdateForm()}update(t){(t.has("context")||t.has("appName"))&&("env-var"===this.context&&(this.heading="Environment variables",this._description=(({appName:t})=>e`List of environment variables that will be injected in the application <strong>${t}</strong>. <a href="http://doc.clever-cloud.com/admin-console/environment-variables/">Learn more</a>`)({appName:this.appName})),"env-var-simple"===this.context&&(this.heading="Environment variables"),"env-var-addon"===this.context&&(this.heading="Environment variables",this.readonly=!0),"exposed-config"===this.context&&(this.heading="Exposed configuration",this._description=(({appName:t})=>e`Configuration exposed to dependent applications.<br>Those variables won't be injected in the application <strong>${t}</strong>, they will be injected as environment variables in applications that have <strong>${t}</strong> in their service dependencies. <a href="https://www.clever-cloud.com/doc/admin-console/service-dependencies/">Learn more</a>`)({appName:this.appName}))),t.has("variables")&&(this._initVariables=this.variables,this._isPristine=!0,null==this.variables?(this._currentVariables=null,this._expertVariables=null):(this._currentVariables=this.variables.sort(((e,t)=>e.name.localeCompare(t.name))),this._expertVariables=this.variables.sort(((e,t)=>e.name.localeCompare(t.name))))),super.update(t)}render(){const e=this.saving||null!=this.error,t=null==this._currentVariables||this._isPristine||e,s=this.saving||null!=this.error;return r`<div class=header>${null!=this.heading?r`<div class=heading>${this.heading}</div>`:""}<cc-toggle class="${a({hasOverlay:s})} mode-switcher" value=${this._mode} .choices=${this._getModes()} ?disabled=${e} @cc-toggle:input=${this._onToggleMode}></cc-toggle></div><slot class=description>${this._description}</slot><div class=overlay-container><cc-expand class=${a({hasOverlay:s})}><cc-env-var-editor-simple ?hidden=${"SIMPLE"!==this._mode} .variables=${this._currentVariables} ?disabled=${e} ?readonly=${this.readonly} @cc-env-var-editor-simple:change=${this._onChange} @cc-input-text:requestimplicitsubmit=${e=>this._onRequestSubmit(e,t)}></cc-env-var-editor-simple><cc-env-var-editor-expert ?hidden=${"EXPERT"!==this._mode} .variables=${this._expertVariables} ?disabled=${e} ?readonly=${this.readonly} @cc-env-var-editor-expert:change=${this._onChange} @cc-input-text:requestimplicitsubmit=${e=>this._onRequestSubmit(e,t)}></cc-env-var-editor-expert></cc-expand>${"loading"===this.error?r`<div class=error-container><cc-error mode=info>${this._getErrorMessage()}</cc-error></div>`:""} ${"saving"===this.error?r`<div class=error-container><cc-error mode=confirm @cc-error:ok=${()=>i(this,"dismissed-error")}>${this._getErrorMessage()}</cc-error></div>`:""} ${this.saving?r`<cc-loader class=saving-loader></cc-loader>`:""}</div>${this.readonly?"":r`<cc-flex-gap class=button-bar><cc-button ?disabled=${t} @cc-button:click=${this._onResetForm}>Reset changes</cc-button><div class=spacer></div>${this.restartApp?r`<cc-button @cc-button:click=${()=>i(this,"restart-app")}>Restart the app to apply changes</cc-button>`:""}<cc-button success ?disabled=${t} @cc-button:click=${this._onUpdateForm}>Update changes</cc-button></cc-flex-gap>`}`}static get styles(){return[n,s`:host{background:#fff;border:1px solid #bcc2d1;border-radius:.25rem;display:block;padding:1rem}.header{align-items:flex-start;display:flex;justify-content:center;margin-bottom:.5rem}.heading{color:#3a3871;flex:1 1 0;font-size:1.2rem;font-weight:700}.description{color:#555;display:block;font-style:italic;line-height:1.5;margin-bottom:1rem}.hasOverlay{--cc-skeleton-state:paused;filter:blur(.3rem)}.overlay-container{position:relative}cc-expand{margin:-.25rem;padding:.25rem}.error-container{align-items:center;display:flex;flex-direction:column;height:100%;justify-content:center;left:0;position:absolute;top:0;width:100%}.saving-loader{height:100%;left:0;position:absolute;top:0;width:100%}.button-bar{--cc-gap:1rem;margin-top:1.5rem}.spacer{flex:1 1 0}`]}}window.customElements.define("cc-env-var-form",o);export{o as CcEnvVarForm};
