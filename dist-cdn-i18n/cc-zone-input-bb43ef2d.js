import"./cc-zone-280ca68f.js";import"./cc-map-c3cd5dae.js";import"./cc-map-marker-server-90f6bafb.js";import{L as e,d as t,h as o,a as r,c as s}from"./vendor-5e139a4e.js";import{r as i}from"./repeat-b0d66412.js";import{P as n,s as a}from"./zone-48aed84f.js";import{w as d}from"./with-resize-observer-323d9e0d.js";const l=new WeakMap;const c=new Array(6).fill(null);class p extends(d(e)){static get properties(){return{error:{type:Boolean,reflect:!0},selected:{type:String},zones:{type:Array},_centerLat:{type:Number},_centerLon:{type:Number},_hovered:{type:String},_legend:{type:String},_points:{type:Array},_sortedZones:{type:Array}}}constructor(e){super(e),this.error=!1,this.breakpoints={width:[600]},this._legend="",this._points=[]}_updatePoints(){Array.isArray(this._sortedZones)&&(this._points=this._sortedZones.filter((e=>!e.tags.includes(n))).map((e=>({name:e.name,lat:e.lat,lon:e.lon,marker:{tag:"cc-map-marker-server",state:this._getState(e.name)},tooltip:{tag:"cc-zone",zone:e,mode:"small"},zIndexOffset:this._getZIndexOffset(e.name)}))),this._legend=this._sortedZones.some((e=>e.tags.includes(n)))?"Private zones don't appear on the map.":"")}_getState(e){return this.selected===e?"selected":this._hovered===e?"hovered":"default"}_getZIndexOffset(e){return this.selected===e?200:this._hovered===e?250:0}_onSelect(e){this.selected=e,t(this,"input",this.selected)}_onListHover(e){this._hovered=e,this._updatePoints(),this._panMap()}_onMarkerHover(e){this._hovered=e,this._updatePoints(),this._scrollChildIntoParent(this._hovered||this.selected)}_panMap(){clearTimeout(this._panMapTimeout),this._panMapTimeout=setTimeout((()=>{if(null!=this._hovered){const e=this._sortedZones.find((e=>e.name===this._hovered));this._map.panInside(e.lat,e.lon)}else if(null!=this.selected){const e=this._sortedZones.find((e=>e.name===this.selected));this._map.panInside(e.lat,e.lon)}}),200)}_scrollChildIntoParent(e){!function(e,t){const o=l.get(e);clearTimeout(o);const r=setTimeout((()=>{null!=t&&function(e,t){const o=e.getBoundingClientRect(),r=t.getBoundingClientRect();if(r.top<o.top){const t=r.top-o.top;e.scrollBy({top:t,behavior:"smooth"})}else if(r.bottom>o.bottom&&r.top>o.top){const t=r.bottom-o.bottom;e.scrollBy({top:t,behavior:"smooth"})}}(e,t)}),200);l.set(e,r)}(this.shadowRoot.querySelector(".zone-list-wrapper"),this.shadowRoot.querySelector(`input[id=${e}]`))}firstUpdated(){this._map=this.shadowRoot.querySelector("cc-map")}updated(e){e.has("selected")&&(this._updatePoints(),this._scrollChildIntoParent(this.selected),this._panMap()),e.has("zones")&&(this._sortedZones=a(this.zones),this._updatePoints()),super.updated(e)}render(){const e=null==this._sortedZones,t=e?c:this._sortedZones;return o`<cc-map view-zoom=1 center-lat=35 .points=${this._points} ?loading=${e&&!this.error} @cc-map:marker-click=${e=>this._onSelect(e.detail.name)} @cc-map:marker-enter=${e=>this._onMarkerHover(e.detail.name)} @cc-map:marker-leave=${e=>this._onMarkerHover()}>${this._legend}</cc-map><div class=zone-list-wrapper>${this.error?o`<cc-error>Something went wrong while loading zones.</cc-error>`:""} ${this.error?"":o`<div class=zone-list>${i(t,(e=>e?.name??""),(e=>this._renderZoneInput(e)))}</div>`}</div>`}_renderZoneInput(e){return null==e?o`<div class=zone><div class=label><cc-zone></cc-zone></div></div>`:o`<div class=zone-choice><input type=radio name=zone .value=${e.name} id=${e.name} .checked=${e.name===this.selected} @change=${t=>this._onSelect(e.name)}> <label for=${e.name} class="${r({hovered:e.name===this._hovered})} label" @mouseenter=${()=>this._onListHover(e.name)} @mouseleave=${()=>this._onListHover()}><cc-zone .zone=${e}></cc-zone></label></div>`}static get styles(){return[s`:host{background-color:#fff;border:1px solid #bcc2d1;border-radius:.25rem;box-sizing:border-box;display:flex;overflow:hidden}.zone-list-wrapper,cc-map{flex-grow:1}cc-map{border-right:1px solid #bcc2d1;flex-basis:0;height:100%;width:100%}:host([error]) cc-map,:host([w-lt-600]) cc-map{display:none}.zone-list-wrapper{box-sizing:border-box;height:100%;overflow:auto}:host(:not([error])[w-gte-600]) .zone-list-wrapper{flex-basis:24rem;max-width:24rem}:host([error]) .zone-list-wrapper{display:flex;padding:1rem}:host([error]) cc-error{margin:auto}.zone-list{margin:.5rem}.zone-list:not(:hover):focus-within{border-radius:.25rem;box-shadow:0 0 0 .2em rgba(50,115,220,.25);outline:0}.zone-choice{display:grid;overflow:hidden}.label,input{grid-area:1/1/2/2}input{-moz-appearance:none;-webkit-appearance:none;appearance:none;border:0;box-sizing:border-box;display:block;margin:-.5rem;outline:0}.label{border:2px solid var(--bd-color,transparent);border-radius:.25rem;box-sizing:border-box;display:block;padding:.5rem}label{cursor:pointer}input:checked+.label{--bd-color:#2b96fd}input:hover+.label,label.hovered{background:#f3f3f3}cc-zone{width:100%}`]}}window.customElements.define("cc-zone-input",p);export{p as CcZoneInput};
