function t(t,e){const r={};return null!=t&&Object.entries(t).forEach((([t,n])=>{null!=n&&e.includes(t)&&(r[t]=n)})),r}const e=new Map;const r=864e5;function n(r,n=1e3,o){const s=function(e){const r=t(e,["API_HOST","WARP_10_HOST","API_OAUTH_TOKEN","API_OAUTH_TOKEN_SECRET","OAUTH_CONSUMER_KEY","OAUTH_CONSUMER_SECRET","method","url","queryParams"]);return JSON.stringify(r)}(r);if("get"===r.method&&e.has(s)&&0!==n)return e.get(s);const a=o();return"get"===r.method&&0!==n&&(e.set(s,a),setTimeout((()=>{e.delete(s)}),n)),a}var o,s=(function(t,e){function r(t){if(!(this instanceof r))return new r(t);if(t||(t={}),!t.consumer)throw new Error("consumer option is required");if(this.consumer=t.consumer,this.nonce_length=t.nonce_length||32,this.version=t.version||"1.0",this.parameter_seperator=t.parameter_seperator||", ",this.realm=t.realm,void 0===t.last_ampersand?this.last_ampersand=!0:this.last_ampersand=t.last_ampersand,this.signature_method=t.signature_method||"PLAINTEXT","PLAINTEXT"!=this.signature_method||t.hash_function||(t.hash_function=function(t,e){return e}),!t.hash_function)throw new Error("hash_function option is required");this.hash_function=t.hash_function,this.body_hash_function=t.body_hash_function||this.hash_function}t.exports=r,r.prototype.authorize=function(t,e){var r={oauth_consumer_key:this.consumer.key,oauth_nonce:this.getNonce(),oauth_signature_method:this.signature_method,oauth_timestamp:this.getTimeStamp(),oauth_version:this.version};return e||(e={}),void 0!==e.key&&(r.oauth_token=e.key),t.data||(t.data={}),t.includeBodyHash&&(r.oauth_body_hash=this.getBodyHash(t,e.secret)),r.oauth_signature=this.getSignature(t,e.secret,r),r},r.prototype.getSignature=function(t,e,r){return this.hash_function(this.getBaseString(t,r),this.getSigningKey(e))},r.prototype.getBodyHash=function(t,e){var r="string"==typeof t.data?t.data:JSON.stringify(t.data);if(!this.body_hash_function)throw new Error("body_hash_function option is required");return this.body_hash_function(r,this.getSigningKey(e))},r.prototype.getBaseString=function(t,e){return t.method.toUpperCase()+"&"+this.percentEncode(this.getBaseUrl(t.url))+"&"+this.percentEncode(this.getParameterString(t,e))},r.prototype.getParameterString=function(t,e){var r;r=e.oauth_body_hash?this.sortObject(this.percentEncodeData(this.mergeObject(e,this.deParamUrl(t.url)))):this.sortObject(this.percentEncodeData(this.mergeObject(e,this.mergeObject(t.data,this.deParamUrl(t.url)))));for(var n="",o=0;o<r.length;o++){var s=r[o].key,a=r[o].value;if(a&&Array.isArray(a)){a.sort();var i="";a.forEach(function(t,e){i+=s+"="+t,e<a.length&&(i+="&")}.bind(this)),n+=i}else n+=s+"="+a+"&"}return n=n.substr(0,n.length-1)},r.prototype.getSigningKey=function(t){return t=t||"",this.last_ampersand||t?this.percentEncode(this.consumer.secret)+"&"+this.percentEncode(t):this.percentEncode(this.consumer.secret)},r.prototype.getBaseUrl=function(t){return t.split("?")[0]},r.prototype.deParam=function(t){for(var e=t.split("&"),r={},n=0;n<e.length;n++){var o=e[n].split("=");o[1]=o[1]||"",r[o[0]]?(Array.isArray(r[o[0]])||(r[o[0]]=[r[o[0]]]),r[o[0]].push(decodeURIComponent(o[1]))):r[o[0]]=decodeURIComponent(o[1])}return r},r.prototype.deParamUrl=function(t){var e=t.split("?");return 1===e.length?{}:this.deParam(e[1])},r.prototype.percentEncode=function(t){return encodeURIComponent(t).replace(/\!/g,"%21").replace(/\*/g,"%2A").replace(/\'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")},r.prototype.percentEncodeData=function(t){var e={};for(var r in t){var n=t[r];if(n&&Array.isArray(n)){var o=[];n.forEach(function(t){o.push(this.percentEncode(t))}.bind(this)),n=o}else n=this.percentEncode(n);e[this.percentEncode(r)]=n}return e},r.prototype.toHeader=function(t){var e=this.sortObject(t),r="OAuth ";this.realm&&(r+='realm="'+this.realm+'"'+this.parameter_seperator);for(var n=0;n<e.length;n++)0===e[n].key.indexOf("oauth_")&&(r+=this.percentEncode(e[n].key)+'="'+this.percentEncode(e[n].value)+'"'+this.parameter_seperator);return{Authorization:r.substr(0,r.length-this.parameter_seperator.length)}},r.prototype.getNonce=function(){for(var t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",e="",r=0;r<this.nonce_length;r++)e+=t[parseInt(Math.random()*t.length,10)];return e},r.prototype.getTimeStamp=function(){return parseInt((new Date).getTime()/1e3,10)},r.prototype.mergeObject=function(t,e){e=e||{};var r=t=t||{};for(var n in e)r[n]=e[n];return r},r.prototype.sortObject=function(t){var e=Object.keys(t),r=[];e.sort();for(var n=0;n<e.length;n++){var o=e[n];r.push({key:o,value:t[o]})}return r}}(o={exports:{}},o.exports),o.exports);function a(t){return async function(e){const{method:r,url:n,headers:o,queryParams:a}=e,i=s({consumer:{key:t.OAUTH_CONSUMER_KEY,secret:t.OAUTH_CONSUMER_SECRET},signature_method:"HMAC-SHA512",async hash_function(t,e){const r=new TextEncoder,n=r.encode(t),o=r.encode(e),s=await window.crypto.subtle.importKey("raw",o,{name:"HMAC",hash:"SHA-512"},!1,["sign"]);return function(t){let e="";const r=new Uint8Array(t),n=r.byteLength;for(let t=0;t<n;t++)e+=String.fromCharCode(r[t]);return window.btoa(e)}(await window.crypto.subtle.sign({name:"HMAC",hash:"SHA-512"},s,n))}}),c={url:n,method:r,data:a},h=i.authorize(c,{key:t.API_OAUTH_TOKEN,secret:t.API_OAUTH_TOKEN_SECRET});h.oauth_signature=await h.oauth_signature;const u=i.toHeader(h);return{...e,headers:{...u,...o}}}}function i(t){return function(e){const{url:r=""}=e;return{...e,url:`${t}${r}`}}}const c=3e4;function h(t,e,r){const n=function(t){const e=new window.AbortController;null!=t&&t.addEventListener("abort",(()=>e.abort()),{once:!0});return e}(e.signal),o=window.fetch(t,{...e,signal:n.signal}),s=new Promise(((t,e)=>setTimeout((()=>{n.abort(),e(new Error("TimeoutError"))}),r||3e5)));return Promise.race([o,s])}async function u(t){const e=new URL(t.url);return Object.entries(t.queryParams||{}).forEach((([t,r])=>e.searchParams.set(t,r))),h(e.toString(),{...t,mode:"cors"},t.timeout).then((t=>{if(200!==t.status){const e="Warp10 Error: "+t.headers.get("X-Warp10-Error-Message");throw new Error(e)}return t.json()})).then((e=>null!=t.responseHandler?t.responseHandler(e):e))}const p="application/x-www-form-urlencoded";function d(t){const e=function(t){const e=t.get("Content-Type");return null!=e?e.split(";")[0]:e}(t.headers);return"application/json"===e?t.json():e===p?t.text().then((t=>{const e={};return Array.from(new URLSearchParams(t).entries()).forEach((([t,r])=>e[t]=r)),e})):t.text()}async function l(t){const e=new URL(t.url);Object.entries(t.queryParams||{}).forEach((([t,r])=>e.searchParams.set(t,r)));const r=function(t){if("application/json"===t.headers["Content-Type"]&&"string"!=typeof t.body)return JSON.stringify(t.body);if(t.headers["Content-Type"]===p&&"string"!=typeof t.body){const e=new URLSearchParams;return Object.entries(t.body).forEach((([t,r])=>e.set(t,r))),e.toString()}return t.body}(t),n=await h(e.toString(),{...t,body:r,mode:"cors"},t.timeout);if(n.status>=400){const t=await d(n),e=null!=t.message?t.message:t,r=new Error(e);throw null!=t.id&&(r.id=t.id),r.response=n,r.responseBody=t,r}if(204!==n.status)return d(n)}function f(t={}){return e=>({...e,...t})}function g({apiConfig:t={},signal:e,cacheDelay:r,timeout:o}){return s=>n({...t,...s},r,(()=>{const{API_HOST:r="https://api.clever-cloud.com",...n}=t;return Promise.resolve(s).then(i(r)).then(a(n)).then(f({signal:e,timeout:o})).then(l)}))}function m({apiConfig:t={},signal:e,cacheDelay:r,timeout:o}){return s=>n({...t,...s},r,(()=>{const{WARP_10_HOST:r}=t;return Promise.resolve(s).then(i(r)).then(f({signal:e,timeout:o})).then(u)}))}export{r as O,c as T,i as a,a as b,m as c,t as p,g as s};
