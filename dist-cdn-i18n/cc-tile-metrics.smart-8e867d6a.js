import{i as e,g as a}from"./api-helpers-f5c0afc4.js";import{d as t}from"./request.fetch-17efde15.js";import{s as n}from"./send-to-api-3f46dae0.js";import"./cc-smart-container-f668ab58.js";import"./cc-tile-metrics-e7d8d614.js";function i(e,a){return(e?.find((e=>e.name===a))?.data??[]).map((({timestamp:e,value:a})=>({timestamp:e/1e3,value:parseFloat(a)})))}t({selector:"cc-tile-metrics",params:{apiConfig:{type:Object},ownerId:{type:String},appId:{type:String},consoleGrafanaLink:{type:String},grafanaBaseLink:{type:String}},onContextUpdate({component:t,context:r,onEvent:p,updateComponent:s,signal:o}){const{apiConfig:c,ownerId:m,appId:d,grafanaBaseLink:g,consoleGrafanaLink:f}=r;s("state",{type:"loading"}),function({apiConfig:a,ownerId:t,appId:r,signal:p}){return e({id:t,appId:r,interval:"P1D",span:"PT1H"}).then(n({apiConfig:a,signal:p})).then((e=>({cpuMetrics:i(e,"cpu"),memMetrics:i(e,"mem")})))}({apiConfig:c,ownerId:m,appId:d,signal:o}).then((({cpuMetrics:e,memMetrics:a})=>{0===e.length||0===a.length||24===e.filter((e=>0===e.value)).length?s("metricsState",{type:"empty"}):s("metricsState",{type:"loaded",metricsData:{cpuMetrics:e,memMetrics:a}})})).catch((e=>{console.error(e),s("metricsState",{type:"error"})})),function({apiConfig:e,ownerId:t,appId:i,grafanaBaseLink:r,signal:p}){return a({id:t}).then(n({apiConfig:e,signal:p})).then((e=>{const a=new URL("/d/runtime/application-runtime",r);return a.searchParams.set("orgId",e.id),a.searchParams.set("var-SELECT_APP",i),a.toString()}))}({apiConfig:c,ownerId:m,appId:d,grafanaBaseLink:g,signal:o}).then((e=>{s("grafanaLinkState",{type:"loaded",link:e})})).catch((()=>{s("grafanaLinkState",{type:"loaded",link:f})}))}});
