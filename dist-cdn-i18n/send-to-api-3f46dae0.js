import{f as t,w as e,r}from"./request.fetch-17efde15.js";import{d as n}from"./events-4c8e3503.js";var o,a,s=(o=function(t,e){function r(t){if(!(this instanceof r))return new r(t);if(t||(t={}),!t.consumer)throw new Error("consumer option is required");if(this.consumer=t.consumer,this.nonce_length=t.nonce_length||32,this.version=t.version||"1.0",this.parameter_seperator=t.parameter_seperator||", ",this.realm=t.realm,void 0===t.last_ampersand?this.last_ampersand=!0:this.last_ampersand=t.last_ampersand,this.signature_method=t.signature_method||"PLAINTEXT","PLAINTEXT"!=this.signature_method||t.hash_function||(t.hash_function=function(t,e){return e}),!t.hash_function)throw new Error("hash_function option is required");this.hash_function=t.hash_function,this.body_hash_function=t.body_hash_function||this.hash_function}t.exports=r,r.prototype.authorize=function(t,e){var r={oauth_consumer_key:this.consumer.key,oauth_nonce:this.getNonce(),oauth_signature_method:this.signature_method,oauth_timestamp:this.getTimeStamp(),oauth_version:this.version};return e||(e={}),void 0!==e.key&&(r.oauth_token=e.key),t.data||(t.data={}),t.includeBodyHash&&(r.oauth_body_hash=this.getBodyHash(t,e.secret)),r.oauth_signature=this.getSignature(t,e.secret,r),r},r.prototype.getSignature=function(t,e,r){return this.hash_function(this.getBaseString(t,r),this.getSigningKey(e))},r.prototype.getBodyHash=function(t,e){var r="string"==typeof t.data?t.data:JSON.stringify(t.data);if(!this.body_hash_function)throw new Error("body_hash_function option is required");return this.body_hash_function(r,this.getSigningKey(e))},r.prototype.getBaseString=function(t,e){return t.method.toUpperCase()+"&"+this.percentEncode(this.getBaseUrl(t.url))+"&"+this.percentEncode(this.getParameterString(t,e))},r.prototype.getParameterString=function(t,e){var r;r=e.oauth_body_hash?this.sortObject(this.percentEncodeData(this.mergeObject(e,this.deParamUrl(t.url)))):this.sortObject(this.percentEncodeData(this.mergeObject(e,this.mergeObject(t.data,this.deParamUrl(t.url)))));for(var n="",o=0;o<r.length;o++){var a=r[o].key,s=r[o].value;if(s&&Array.isArray(s)){s.sort();var i="";s.forEach(function(t,e){i+=a+"="+t,e<s.length&&(i+="&")}.bind(this)),n+=i}else n+=a+"="+s+"&"}return n=n.substr(0,n.length-1)},r.prototype.getSigningKey=function(t){return t=t||"",this.last_ampersand||t?this.percentEncode(this.consumer.secret)+"&"+this.percentEncode(t):this.percentEncode(this.consumer.secret)},r.prototype.getBaseUrl=function(t){return t.split("?")[0]},r.prototype.deParam=function(t){for(var e=t.split("&"),r={},n=0;n<e.length;n++){var o=e[n].split("=");o[1]=o[1]||"",r[o[0]]?(Array.isArray(r[o[0]])||(r[o[0]]=[r[o[0]]]),r[o[0]].push(decodeURIComponent(o[1]))):r[o[0]]=decodeURIComponent(o[1])}return r},r.prototype.deParamUrl=function(t){var e=t.split("?");return 1===e.length?{}:this.deParam(e[1])},r.prototype.percentEncode=function(t){return encodeURIComponent(t).replace(/\!/g,"%21").replace(/\*/g,"%2A").replace(/\'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")},r.prototype.percentEncodeData=function(t){var e={};for(var r in t){var n=t[r];if(n&&Array.isArray(n)){var o=[];n.forEach(function(t){o.push(this.percentEncode(t))}.bind(this)),n=o}else n=this.percentEncode(n);e[this.percentEncode(r)]=n}return e},r.prototype.toHeader=function(t){var e=this.sortObject(t),r="OAuth ";this.realm&&(r+='realm="'+this.realm+'"'+this.parameter_seperator);for(var n=0;n<e.length;n++)0===e[n].key.indexOf("oauth_")&&(r+=this.percentEncode(e[n].key)+'="'+this.percentEncode(e[n].value)+'"'+this.parameter_seperator);return{Authorization:r.substr(0,r.length-this.parameter_seperator.length)}},r.prototype.getNonce=function(){for(var t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",e="",r=0;r<this.nonce_length;r++)e+=t[parseInt(62*Math.random(),10)];return e},r.prototype.getTimeStamp=function(){return parseInt((new Date).getTime()/1e3,10)},r.prototype.mergeObject=function(t,e){e=e||{};var r=t=t||{};for(var n in e)r[n]=e[n];return r},r.prototype.sortObject=function(t){var e=Object.keys(t),r=[];e.sort();for(var n=0;n<e.length;n++){var o=e[n];r.push({key:o,value:t[o]})}return r}},o(a={exports:{}},a.exports),a.exports),i=s;function h(t){return async function(e){const r=await async function(){return null!=globalThis.crypto?.subtle?globalThis.crypto?.subtle:(await import("node:crypto")).subtle}(),{method:n,url:o,headers:a,queryParams:s}=e,h=i({consumer:{key:t.OAUTH_CONSUMER_KEY,secret:t.OAUTH_CONSUMER_SECRET},signature_method:"HMAC-SHA512",async hash_function(t,e){const n=new TextEncoder,o=n.encode(t),a=n.encode(e),s=await r.importKey("raw",a,{name:"HMAC",hash:"SHA-512"},!1,["sign"]),i=await r.sign({name:"HMAC",hash:"SHA-512"},s,o);let h="";const c=new Uint8Array(i),u=c.byteLength;for(let t=0;t<u;t++)h+=String.fromCharCode(c[t]);return globalThis.btoa(h)}}),c={url:o,method:n,data:s},u=h.authorize(c,{key:t.API_OAUTH_TOKEN,secret:t.API_OAUTH_TOKEN_SECRET});u.oauth_signature=await u.oauth_signature;const p=h.toHeader(u);return{...e,headers:{...p,...a}}}}function c(t){return function(e){const{url:r=""}=e;return{...e,url:`${t}${r}`}}}async function u(e){const r=new URL(e.url);return Object.entries(e.queryParams||{}).forEach((([t,e])=>r.searchParams.set(t,e))),t(r.toString(),{...e,mode:"cors"},e.timeout).then((t=>{if(200!==t.status){const e="Warp10 Error: "+t.headers.get("X-Warp10-Error-Message");throw new Error(e)}return t.json()})).then((t=>null!=e.responseHandler?e.responseHandler(t):t))}function p(t={}){return e=>({...e,...t})}function d({apiConfig:t,signal:o,cacheDelay:a,timeout:s}){return i=>{const u={...t,...i};return e(u,a,(()=>{const{API_HOST:e="https://api.clever-cloud.com",...a}=t;return Promise.resolve(i).then(c(e)).then(h(a)).then(p({signal:o,timeout:s})).then(r).catch((t=>{throw n(window,"cc-api:error",t),t}))}))}}function g({apiConfig:t,signal:r,cacheDelay:n,timeout:o}){return a=>{const s={...t,...a};return e(s,n,(()=>{const{WARP_10_HOST:e}=t;return Promise.resolve(a).then(c(e)).then(p({signal:r,timeout:o})).then(u)}))}}export{h as a,g as b,c as p,d as s};
