import"./cc-grafana-info-37b3d86c.js";import"./cc-smart-container-f668ab58.js";import{r as a,d as n,c as e,g as t}from"./api-helpers-f5c0afc4.js";import{d as o}from"./request.fetch-17efde15.js";import{b as i,a as r}from"./notifications-1d2a2395.js";import{s}from"./send-to-api-3f46dae0.js";o({selector:"cc-grafana-info",params:{apiConfig:{type:Object},ownerId:{type:String},grafanaBaseLink:{type:String}},onContextUpdate({context:o,updateComponent:d,onEvent:c,signal:f}){const{apiConfig:l,ownerId:u,grafanaBaseLink:g}=o;function p(){(function({apiConfig:a,signal:n,ownerId:e,grafanaBaseLink:o}){return t({id:e}).then(s({apiConfig:a,signal:n})).then((a=>{const n=new URL("/d/home/clever-cloud-metrics-home",o);return n.searchParams.set("orgId",a.id),{status:"enabled",link:n.toString()}})).catch((a=>{if(404===a.response?.status&&a.toString().startsWith("Error: Grafana organization not found"))return{status:"disabled"};throw a}))})({apiConfig:l,signal:f,ownerId:u,grafanaBaseLink:g}).then((a=>{d("state",{type:"loaded",info:a})})).catch((a=>{console.error(a),d("state",{type:"error"})}))}d("state",{type:"loading"}),c("cc-grafana-info:reset",(()=>{d("state",(a=>{a.info.action="resetting"})),function({apiConfig:n,ownerId:e}){return a({id:e}).then(s({apiConfig:n}))}({apiConfig:l,ownerId:u}).then((()=>i("Les tableaux de bords du grafana ont été réinitialisés avec succès."))).catch((a=>{console.error(a),r("Une erreur s'est produite lors de la réinitialisation des tableaux de bord du Grafana.")})).finally((()=>{d("state",(a=>{a.info.action=null}))}))})),c("cc-grafana-info:disable",(()=>{d("state",(a=>{a.info.action="disabling"})),function({apiConfig:a,ownerId:e}){return n({id:e}).then(s({apiConfig:a}))}({apiConfig:l,ownerId:u}).then((()=>{d("state",(a=>{a.info={status:"disabled"}})),i("Les tableaux de bords du Grafana ont été désactivés avec succès.")})).catch((a=>{console.error(a),r("Une erreur s'est produite lors de la désactivation des tableaux de bord du Grafana.")})).finally((()=>{d("state",(a=>{a.info.action=null}))}))})),c("cc-grafana-info:enable",(()=>{d("state",(a=>{a.info.action="enabling"})),function({apiConfig:a,ownerId:n}){return e({id:n}).then(s({apiConfig:a}))}({apiConfig:l,ownerId:u}).then((()=>{p(),i("Les tableaux de bords du Grafana ont été activés avec succès.")})).catch((a=>{console.error(a),r("Une erreur s'est produite lors de l'activation des tableaux de bord du Grafana.")})).finally((()=>{d("state",(a=>{a.info.action=null}))}))})),p()}});
