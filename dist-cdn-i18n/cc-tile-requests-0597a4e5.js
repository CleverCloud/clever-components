import{g as t,s as e,h as a,b as r,i,e as o}from"./i18n-bf531c19.js";import"./cc-button-0fc35634.js";import"./cc-error-8d730ec3.js";import{m as n,t as s,r as l,d,a as c,v as h,c as u,i as f,e as _,A as y,P as x,B as p,b,C as v,f as g,p as m,g as w,L as k,h as $}from"./chart.esm-dc52f043.js";import{L as M,h as C,a as P,s as A,c as S}from"./vendor-5e139a4e.js";import{w as I}from"./with-resize-observer-323d9e0d.js";import{t as R}from"./info-tiles-0fcdc9dd.js";const T=o("en"),B=a("en");var D=function(){if("undefined"!=typeof window){if(window.devicePixelRatio)return window.devicePixelRatio;var t=window.screen;if(t)return(t.deviceXDPI||1)/(t.logicalXDPI||1)}return 1}(),z=function(t){var e,a=[];for(t=[].concat(t);t.length;)"string"==typeof(e=t.pop())?a.unshift.apply(a,e.split("\n")):Array.isArray(e)?t.push.apply(t,e):f(t)||a.unshift(""+e);return a},q=function(t,e,a){var r,i=[].concat(e),o=i.length,n=t.font,s=0;for(t.font=a.string,r=0;r<o;++r)s=Math.max(t.measureText(i[r]).width,s);return t.font=n,{height:o*a.lineHeight,width:s}},E=function(t,e,a){return Math.max(t,Math.min(e,a))},j=function(t,e){var a,r,i,o,n=t.slice(),s=[];for(a=0,i=e.length;a<i;++a)o=e[a],-1===(r=n.indexOf(o))?s.push([o,1]):n.splice(r,1);for(a=0,i=n.length;a<i;++a)s.push([n[a],-1]);return s};function W(t,e){var a=e.x,r=e.y;if(null===a)return{x:0,y:-1};if(null===r)return{x:1,y:0};var i=t.x-a,o=t.y-r,n=Math.sqrt(i*i+o*o);return{x:n?i/n:0,y:n?o/n:-1}}function H(t,e,a){var r=0;return t<a.left?r|=1:t>a.right&&(r|=2),e<a.top?r|=8:e>a.bottom&&(r|=4),r}function U(t,e){var a,r,i=e.anchor,o=t;return e.clamp&&(o=function(t,e){for(var a,r,i,o=t.x0,n=t.y0,s=t.x1,l=t.y1,d=H(o,n,e),c=H(s,l,e);d|c&&!(d&c);)8&(a=d||c)?(r=o+(s-o)*(e.top-n)/(l-n),i=e.top):4&a?(r=o+(s-o)*(e.bottom-n)/(l-n),i=e.bottom):2&a?(i=n+(l-n)*(e.right-o)/(s-o),r=e.right):1&a&&(i=n+(l-n)*(e.left-o)/(s-o),r=e.left),a===d?d=H(o=r,n=i,e):c=H(s=r,l=i,e);return{x0:o,x1:s,y0:n,y1:l}}(o,e.area)),"start"===i?(a=o.x0,r=o.y0):"end"===i?(a=o.x1,r=o.y1):(a=(o.x0+o.x1)/2,r=(o.y0+o.y1)/2),function(t,e,a,r,i){switch(i){case"center":a=r=0;break;case"bottom":a=0,r=1;break;case"right":a=1,r=0;break;case"left":a=-1,r=0;break;case"top":a=0,r=-1;break;case"start":a=-a,r=-r;break;case"end":break;default:i*=Math.PI/180,a=Math.cos(i),r=Math.sin(i)}return{x:t,y:e,vx:a,vy:r}}(a,r,t.vx,t.vy,e.align)}var L=function(t,e){var a=(t.startAngle+t.endAngle)/2,r=Math.cos(a),i=Math.sin(a),o=t.innerRadius,n=t.outerRadius;return U({x0:t.x+r*o,y0:t.y+i*o,x1:t.x+r*n,y1:t.y+i*n,vx:r,vy:i},e)},N=function(t,e){var a=W(t,e.origin),r=a.x*t.options.radius,i=a.y*t.options.radius;return U({x0:t.x-r,y0:t.y-i,x1:t.x+r,y1:t.y+i,vx:a.x,vy:a.y},e)},V=function(t,e){var a=W(t,e.origin),r=t.x,i=t.y,o=0,n=0;return t.horizontal?(r=Math.min(t.x,t.base),o=Math.abs(t.base-t.x)):(i=Math.min(t.y,t.base),n=Math.abs(t.base-t.y)),U({x0:r,y0:i+n,x1:r+o,y1:i,vx:a.x,vy:a.y},e)},O=function(t,e){var a=W(t,e.origin);return U({x0:t.x,y0:t.y,x1:t.x,y1:t.y,vx:a.x,vy:a.y},e)},X=function(t){return Math.round(t*D)/D};function F(t,e){var a=e.chart.getDatasetMeta(e.datasetIndex).vScale;if(!a)return null;if(void 0!==a.xCenter&&void 0!==a.yCenter)return{x:a.xCenter,y:a.yCenter};var r=a.getBasePixel();return t.horizontal?{x:r,y:null}:{x:null,y:r}}function G(t,e,a){var r=a.backgroundColor,i=a.borderColor,o=a.borderWidth;(r||i&&o)&&(t.beginPath(),function(t,e,a,r,i,o){var n=Math.PI/2;if(o){var s=Math.min(o,i/2,r/2),l=e+s,d=a+s,c=e+r-s,h=a+i-s;t.moveTo(e,d),l<c&&d<h?(t.arc(l,d,s,-Math.PI,-n),t.arc(c,d,s,-n,0),t.arc(c,h,s,0,n),t.arc(l,h,s,n,Math.PI)):l<c?(t.moveTo(l,a),t.arc(c,d,s,-n,n),t.arc(l,d,s,n,Math.PI+n)):d<h?(t.arc(l,d,s,-Math.PI,0),t.arc(l,h,s,0,Math.PI)):t.arc(l,d,s,-Math.PI,Math.PI),t.closePath(),t.moveTo(e,a)}else t.rect(e,a,r,i)}(t,X(e.x)+o/2,X(e.y)+o/2,X(e.w)-o,X(e.h)-o,a.borderRadius),t.closePath(),r&&(t.fillStyle=r,t.fill()),i&&o&&(t.strokeStyle=i,t.lineWidth=o,t.lineJoin="miter",t.stroke()))}function J(t,e,a){var r=t.shadowBlur,i=a.stroked,o=X(a.x),n=X(a.y),s=X(a.w);i&&t.strokeText(e,o,n,s),a.filled&&(r&&i&&(t.shadowBlur=0),t.fillText(e,o,n,s),r&&i&&(t.shadowBlur=r))}var Z=function(t,e,a,r){var i=this;i._config=t,i._index=r,i._model=null,i._rects=null,i._ctx=e,i._el=a};n(Z.prototype,{_modelize:function(t,e,a,r){var i,o=this,n=o._index,h=s(l([a.font,{}],r,n)),u=l([a.color,d.color],r,n);return{align:l([a.align,"center"],r,n),anchor:l([a.anchor,"center"],r,n),area:r.chart.chartArea,backgroundColor:l([a.backgroundColor,null],r,n),borderColor:l([a.borderColor,null],r,n),borderRadius:l([a.borderRadius,0],r,n),borderWidth:l([a.borderWidth,0],r,n),clamp:l([a.clamp,!1],r,n),clip:l([a.clip,!1],r,n),color:u,display:t,font:h,lines:e,offset:l([a.offset,0],r,n),opacity:l([a.opacity,1],r,n),origin:F(o._el,r),padding:c(l([a.padding,0],r,n)),positioner:(i=o._el,i instanceof y?L:i instanceof x?N:i instanceof p?V:O),rotation:l([a.rotation,0],r,n)*(Math.PI/180),size:q(o._ctx,e,h),textAlign:l([a.textAlign,"start"],r,n),textShadowBlur:l([a.textShadowBlur,0],r,n),textShadowColor:l([a.textShadowColor,u],r,n),textStrokeColor:l([a.textStrokeColor,u],r,n),textStrokeWidth:l([a.textStrokeWidth,0],r,n)}},update:function(t){var e,a,r,i=this,o=null,n=null,s=i._index,d=i._config,c=l([d.display,!0],t,s);c&&(e=t.dataset.data[s],a=h(u(d.formatter,[e,t]),e),(r=f(a)?[]:z(a)).length&&(n=function(t){var e=t.borderWidth||0,a=t.padding,r=t.size.height,i=t.size.width,o=-i/2,n=-r/2;return{frame:{x:o-a.left-e,y:n-a.top-e,w:i+a.width+2*e,h:r+a.height+2*e},text:{x:o,y:n,w:i,h:r}}}(o=i._modelize(c,r,d,t)))),i._model=o,i._rects=n},geometry:function(){return this._rects?this._rects.frame:{}},rotation:function(){return this._model?this._model.rotation:0},visible:function(){return this._model&&this._model.opacity},model:function(){return this._model},draw:function(t,e){var a,r=t.ctx,i=this._model,o=this._rects;this.visible()&&(r.save(),i.clip&&(a=i.area,r.beginPath(),r.rect(a.left,a.top,a.right-a.left,a.bottom-a.top),r.clip()),r.globalAlpha=E(0,i.opacity,1),r.translate(X(e.x),X(e.y)),r.rotate(i.rotation),G(r,o.frame,i),function(t,e,a,r){var i,o=r.textAlign,n=r.color,s=!!n,l=r.font,d=e.length,c=r.textStrokeColor,h=r.textStrokeWidth,u=c&&h;if(d&&(s||u))for(a=function(t,e,a){var r=a.lineHeight,i=t.w,o=t.x;return"center"===e?o+=i/2:"end"!==e&&"right"!==e||(o+=i),{h:r,w:i,x:o,y:t.y+r/2}}(a,o,l),t.font=l.string,t.textAlign=o,t.textBaseline="middle",t.shadowBlur=r.textShadowBlur,t.shadowColor=r.textShadowColor,s&&(t.fillStyle=n),u&&(t.lineJoin="round",t.lineWidth=h,t.strokeStyle=c),i=0,d=e.length;i<d;++i)J(t,e[i],{stroked:u,filled:s,w:a.w,x:a.x,y:a.y+a.h*i})}(r,i.lines,o.text,i),r.restore())}});var K=Number.MIN_SAFE_INTEGER||-9007199254740991,Q=Number.MAX_SAFE_INTEGER||9007199254740991;function Y(t,e,a){var r=Math.cos(a),i=Math.sin(a),o=e.x,n=e.y;return{x:o+r*(t.x-o)-i*(t.y-n),y:n+i*(t.x-o)+r*(t.y-n)}}function tt(t,e){var a,r,i,o,n,s=Q,l=K,d=e.origin;for(a=0;a<t.length;++a)i=(r=t[a]).x-d.x,o=r.y-d.y,n=e.vx*i+e.vy*o,s=Math.min(s,n),l=Math.max(l,n);return{min:s,max:l}}function et(t,e){var a=e.x-t.x,r=e.y-t.y,i=Math.sqrt(a*a+r*r);return{vx:(e.x-t.x)/i,vy:(e.y-t.y)/i,origin:t,ln:i}}var at=function(){this._rotation=0,this._rect={x:0,y:0,w:0,h:0}};function rt(t,e,a){var r=e.positioner(t,e),i=r.vx,o=r.vy;if(!i&&!o)return{x:r.x,y:r.y};var n=a.w,s=a.h,l=e.rotation,d=Math.abs(n/2*Math.cos(l))+Math.abs(s/2*Math.sin(l)),c=Math.abs(n/2*Math.sin(l))+Math.abs(s/2*Math.cos(l)),h=1/Math.max(Math.abs(i),Math.abs(o));return d*=i*h,c*=o*h,d+=e.offset*i,c+=e.offset*o,{x:r.x+d,y:r.y+c}}n(at.prototype,{center:function(){var t=this._rect;return{x:t.x+t.w/2,y:t.y+t.h/2}},update:function(t,e,a){this._rotation=a,this._rect={x:e.x+t.x,y:e.y+t.y,w:e.w,h:e.h}},contains:function(t){var e=this,a=e._rect;return!((t=Y(t,e.center(),-e._rotation)).x<a.x-1||t.y<a.y-1||t.x>a.x+a.w+2||t.y>a.y+a.h+2)},intersects:function(t){var e,a,r,i=this._points(),o=t._points(),n=[et(i[0],i[1]),et(i[0],i[3])];for(this._rotation!==t._rotation&&n.push(et(o[0],o[1]),et(o[0],o[3])),e=0;e<n.length;++e)if(a=tt(i,n[e]),r=tt(o,n[e]),a.max<r.min||r.max<a.min)return!1;return!0},_points:function(){var t=this,e=t._rect,a=t._rotation,r=t.center();return[Y({x:e.x,y:e.y},r,a),Y({x:e.x+e.w,y:e.y},r,a),Y({x:e.x+e.w,y:e.y+e.h},r,a),Y({x:e.x,y:e.y+e.h},r,a)]}});var it={prepare:function(t){var e,a,r,i,o,n=[];for(e=0,r=t.length;e<r;++e)for(a=0,i=t[e].length;a<i;++a)o=t[e][a],n.push(o),o.$layout={_box:new at,_hidable:!1,_visible:!0,_set:e,_idx:a};return n.sort((function(t,e){var a=t.$layout,r=e.$layout;return a._idx===r._idx?r._set-a._set:r._idx-a._idx})),this.update(n),n},update:function(t){var e,a,r,i,o,n=!1;for(e=0,a=t.length;e<a;++e)i=(r=t[e]).model(),(o=r.$layout)._hidable=i&&"auto"===i.display,o._visible=r.visible(),n|=o._hidable;n&&function(t){var e,a,r,i,o,n,s;for(e=0,a=t.length;e<a;++e)(i=(r=t[e]).$layout)._visible&&(s=new Proxy(r._el,{get:(t,e)=>t.getProps([e],!0)[e]}),o=r.geometry(),n=rt(s,r.model(),o),i._box.update(n,o,r.rotation()));(function(t,e){var a,r,i,o;for(a=t.length-1;a>=0;--a)for(i=t[a].$layout,r=a-1;r>=0&&i._visible;--r)(o=t[r].$layout)._visible&&i._box.intersects(o._box)&&e(i,o)})(t,(function(t,e){var a=t._hidable,r=e._hidable;a&&r||r?e._visible=!1:a&&(t._visible=!1)}))}(t)},lookup:function(t,e){var a,r;for(a=t.length-1;a>=0;--a)if((r=t[a].$layout)&&r._visible&&r._box.contains(e))return t[a];return null},draw:function(t,e){var a,r,i,o,n,s;for(a=0,r=e.length;a<r;++a)(o=(i=e[a]).$layout)._visible&&(n=i.geometry(),s=rt(i._el,i.model(),n),o._box.update(s,n,i.rotation()),i.draw(t,s))}};function ot(t,e,a){if(e){var r,i=a.$context,o=a.$groups;e[o._set]&&(r=e[o._set][o._key])&&!0===u(r,[i])&&(t.$datalabels._dirty=!0,a.update(i))}}function nt(t,e){var a,r,i=t.$datalabels,o=i._listeners;if(o.enter||o.leave){if("mousemove"===e.type)r=it.lookup(i._labels,e);else if("mouseout"!==e.type)return;a=i._hovered,i._hovered=r,function(t,e,a,r){var i,o;(a||r)&&(a?r?a!==r&&(o=i=!0):o=!0:i=!0,o&&ot(t,e.leave,a),i&&ot(t,e.enter,r))}(t,o,a,r)}}var st={id:"datalabels",defaults:{align:"center",anchor:"center",backgroundColor:null,borderColor:null,borderRadius:0,borderWidth:0,clamp:!1,clip:!1,color:void 0,display:!0,font:{family:void 0,lineHeight:1.2,size:void 0,style:void 0,weight:null},formatter:function(t){if(f(t))return null;var e,a,r,i=t;if(b(t))if(f(t.label))if(f(t.r))for(i="",r=0,a=(e=Object.keys(t)).length;r<a;++r)i+=(0!==r?", ":"")+e[r]+": "+t[e[r]];else i=t.r;else i=t.label;return""+i},labels:void 0,listeners:{},offset:4,opacity:1,padding:{top:4,right:4,bottom:4,left:4},rotation:0,textAlign:"start",textStrokeColor:void 0,textStrokeWidth:0,textShadowBlur:0,textShadowColor:void 0},beforeInit:function(t){t.$datalabels={_actives:[]}},beforeUpdate:function(t){var e=t.$datalabels;e._listened=!1,e._listeners={},e._datasets=[],e._labels=[]},afterDatasetUpdate:function(t,e,a){var r,i,o,s,l,d,c,h,u=e.index,f=t.$datalabels,y=f._datasets[u]=[],x=t.isDatasetVisible(u),p=t.data.datasets[u],b=function(t,e){var a,r,i,o=t.datalabels,s=[];return!1===o?null:(!0===o&&(o={}),e=n({},[e,o]),r=e.labels||{},i=Object.keys(r),delete e.labels,i.length?i.forEach((function(t){r[t]&&s.push(n({},[e,r[t],{_key:t}]))})):s.push(e),a=s.reduce((function(t,e){return _(e.listeners||{},(function(a,r){t[r]=t[r]||{},t[r][e._key||"$default"]=a})),delete e.listeners,t}),{}),{labels:s,listeners:a})}(p,a),v=e.meta.data||[],g=t.ctx;for(g.save(),r=0,o=v.length;r<o;++r)if((c=v[r]).$datalabels=[],x&&c&&t.getDataVisibility(r)&&!c.skip)for(i=0,s=b.labels.length;i<s;++i)d=(l=b.labels[i])._key,(h=new Z(l,g,c,r)).$groups={_set:u,_key:d||"$default"},h.$context={active:!1,chart:t,dataIndex:r,dataset:p,datasetIndex:u},h.update(h.$context),c.$datalabels.push(h),y.push(h);g.restore(),n(f._listeners,b.listeners,{merger:function(t,a,r){a[t]=a[t]||{},a[t][e.index]=r[t],f._listened=!0}})},afterUpdate:function(t,e){t.$datalabels._labels=it.prepare(t.$datalabels._datasets,e)},afterDatasetsDraw:function(t){it.draw(t,t.$datalabels._labels)},beforeEvent:function(t,e){if(t.$datalabels._listened){var a=e.event;switch(a.type){case"mousemove":case"mouseout":nt(t,a);break;case"click":!function(t,e){var a=t.$datalabels,r=a._listeners.click,i=r&&it.lookup(a._labels,e);i&&ot(t,r,i)}(t,a)}}},afterEvent:function(t){var e,a,r,i,o,n,s,l=t.$datalabels,d=l._actives,c=l._actives=t.getActiveElements(),h=j(d,c);for(e=0,a=h.length;e<a;++e)if((o=h[e])[1])for(r=0,i=(s=o[0].element.$datalabels||[]).length;r<i;++r)(n=s[r]).$context.active=1===o[1],n.update(n.$context);(l._dirty||h.length)&&(it.update(l._labels),t.render()),delete l._dirty}};const lt=new URL(new URL("assets/close-5578d4ce.svg",import.meta.url).href,import.meta.url).href,dt=new URL(new URL("assets/info-fd0d98fe.svg",import.meta.url).href,import.meta.url).href;v.register(g,p,m,w,k,$);const ct=Array.from(new Array(24)).map((()=>[0,0,1]));class ht extends(I(M)){static get properties(){return{data:{type:Object},error:{type:Boolean,reflect:!0},_skeleton:{type:Boolean,attribute:!1},_empty:{type:Boolean,attribute:!1},_docs:{type:Boolean,attribute:!1},_barCount:{type:Number,attribute:!1}}}constructor(){super(),this.error=0,this._barCount=6,this._data=null,this._docs=!1}onResize({width:t}){t<380&&(this._barCount=6),t>=380&&t<540&&(this._barCount=8),t>=540&&(this._barCount=12),this._refreshChart(),this.requestUpdate()}_onToggleDocs(){this._docs=!this._docs}async _refreshChart(){this._skeleton=null==this.data;const e=this._skeleton?ct:this.data;if(this._empty=0===e.length,this._empty)return;const a=24/this._barCount;this._groupedData=Array.from(new Array(this._barCount)).map(((t,r)=>{const i=r*a,o=(r+1)*a;return[e[i][0],e[o-1][1],e.slice(i,o).map((t=>t[2])).reduce(((t,e)=>t+e),0)]})),this._groupedValues=this._groupedData.map((([t,e,a])=>a)),this._xLabels=this._skeleton?this._groupedData.map((()=>"??")):this._groupedData.map((([e],a)=>(({date:e})=>t("en",e))({date:e})));const r=this._skeleton?"#bbb":"#30ab61";await this.updateComplete;const i=Math.ceil(1.2*Math.max(...this._groupedValues));this._chart.options.scales.y.suggestedMax=i,this._chart.options.plugins.tooltip.enabled=!this._skeleton;const o=this._groupedValues.reduce(((t,e)=>t+e),0);this._chart.options.plugins.title.text=this._skeleton?"...":(({totalRequests:t})=>{const e=T(t,"request");return`${B(t)} ${e} in 24 hours`})({totalRequests:o}),this._chart.data={labels:this._xLabels,datasets:[{backgroundColor:r,data:this._groupedValues}]},this._chart.options.animation.duration=this._skeleton?0:300,this._chart.update(),this._chart.resize()}firstUpdated(){this._ctx=this.renderRoot.getElementById("chart"),this._chart=new v(this._ctx,{plugins:[st],type:"bar",options:{responsive:!1,maintainAspectRatio:!1,plugins:{title:{display:!0,position:"bottom",padding:0,font:{style:"italic",weight:"normal"}},legend:{display:!1},tooltip:{backgroundColor:"#000",displayColors:!1,callbacks:{title:([e])=>{const[a,i]=this._groupedData[e.dataIndex];return(({from:e,to:a})=>`${r("en",e)}: from ${t("en",e)} to ${t("en",a)}`)({from:a,to:i})},label:t=>{const e=24/this._barCount;return(({value:t,windowHours:e})=>{const a=T(t,"request"),r=T(e,"hour");return`${i("en",t)} ${a} (in ${e} ${r})`})({value:this._groupedValues[t.dataIndex],windowHours:e})}}},datalabels:{anchor:"end",offset:0,align:"end",formatter:(t,e)=>this._skeleton?"?":(({requestCount:t})=>B(t))({requestCount:t})}},scales:{x:{grid:{drawOnChartArea:!1,drawTicks:!1},ticks:{padding:10,font:{size:12}}},y:{display:!1,beginAtZero:!0}},animation:{duration:0}}})}updated(t){t.has("data")&&this._refreshChart(),super.updated(t)}render(){const t=!this.error&&!this._empty&&!this._docs,a=this.error&&!this._docs,r=this._empty&&!this._docs,i=this._docs;return C`<div class="tile_title tile_title--image">HTTP requests<cc-button class=docs-toggle image=${i?lt:dt} hide-text @cc-button:click=${this._onToggleDocs}>${this._docs?"Display chart":"About this chart..."}</cc-button></div><div class="${P({"tile--hidden":!t})} tile_body"><div class="${P({skeleton:this._skeleton})} chart-container"><canvas id=chart></canvas></div></div><div class="${P({"tile--hidden":!r})} tile_message">No data to display for now.</div><cc-error class="${P({"tile--hidden":!a})} tile_message">Something went wrong while loading HTTP requests.</cc-error><div class="${P({"tile--hidden":!i})} tile_docs"><p>${(({windowHours:t})=>{const a=T(t,"hour");return e`HTTP requests received in the last 24 hours. Each bar represents a time window of <strong>${t} ${a}</strong>.`})({windowHours:24/this._barCount})}</p></div>`}static get styles(){return[R,A,S`.tile_title{align-items:center;display:flex;justify-content:space-between}.docs-toggle{font-size:1rem;margin:0 0 0 1rem}.chart-container{height:100%;min-width:0;position:absolute;width:100%}.tile_body,.tile_docs,.tile_message{grid-area:2/1/2/1}.tile--hidden{visibility:hidden}.tile_body{min-height:140px;position:relative}.tile_docs{align-self:center;font-size:.9rem;font-style:italic}.tile_docs_link{color:#2b96fd;text-decoration:underline}`]}}window.customElements.define("cc-tile-requests",ht);export{ht as CcTileRequests};
