import{i as t,c as e,h as i,e as n}from"./i18n-bf531c19.js";import"./cc-button-0fc35634.js";import"./cc-img-ca15395c.js";import"./cc-input-number-5a04b6b3.js";import"./cc-toggle-8b8e589e.js";import"./cc-error-8d730ec3.js";import{L as s,d as r,h as a,i as l,a as c,s as o,c as u}from"./vendor-5e139a4e.js";import{w as d}from"./with-resize-observer-323d9e0d.js";const m=n("en"),p=i("en","B"," ");function g(t){return p(t).split(" ")[1]}const h=({bytes:t})=>p(t),v=({bytes:t})=>g(t),b=({price:t,code:i})=>`${e("en",t,{currency:i})}`;class y{constructor(t=[]){this._state={},t.forEach((({type:t,intervals:e,progressive:i=!1,secability:n=1})=>{this._state[t]={intervals:e,progressive:i,secability:n,quantity:0}}))}getQuantity(t){return this._state[t].quantity}setQuantity(t,e){isNaN(e)||(this._state[t].quantity=e)}getMaxInterval(t){const{intervals:e,quantity:i}=this._state[t];return e?.find((({minRange:t,maxRange:e})=>i>=t&&i<(e??1/0)))??null}getIntervalPrice(t,e){const i=this._state[t].intervals?.[e]??null;if(null==i)return 0;const n=this._state[t].progressive,s=this._state[t].secability,{price:r}=i,a=this._state[t].quantity,l=Math.ceil(a/s)*s;if(n){const{minRange:t,maxRange:e}=i;return r*function(t,e,i){const n=0===t?0:t-1,s=0===t?i-1:i-t;return Math.max(0,Math.min(e-n,s))}(t,l,e??1/0)}return i===this.getMaxInterval(t)?r*l:0}getSectionPrice(t){return(this._state[t].intervals??[]).map(((e,i)=>this.getIntervalPrice(t,i))).reduce(((t,e)=>t+e),0)}getTotalPrice(){return Object.keys(this._state).map((t=>this.getSectionPrice(t))).reduce(((t,e)=>t+e),0)}}const f=new URL(new URL("assets/arrows-left-2a0b4430.svg",import.meta.url).href,import.meta.url).href,_=new URL(new URL("assets/arrows-right-9d33e797.svg",import.meta.url).href,import.meta.url).href,$=new URL(new URL("assets/down-5b7898da.svg",import.meta.url).href,import.meta.url).href,w=new URL(new URL("assets/plus-b81295d1.svg",import.meta.url).href,import.meta.url).href,x=new URL(new URL("assets/storage-a73f53b5.svg",import.meta.url).href,import.meta.url).href,R=new URL(new URL("assets/sum-1ba8fc4e.svg",import.meta.url).href,import.meta.url).href,U=new URL(new URL("assets/up-a464b04f.svg",import.meta.url).href,import.meta.url).href,k=new URL(new URL("assets/user-087432d3.svg",import.meta.url).href,import.meta.url).href,I={code:"EUR",changeRate:1},L={storage:x,"inbound-traffic":_,"outbound-traffic":f,"private-users":k,"public-users":k},T=[{minRange:0,maxRange:1e8,price:0},{minRange:1e8,maxRange:1e12,price:1e-4},{minRange:1e12,maxRange:1e13,price:1e-5},{minRange:1e13,price:1e-6}];class q extends(d(s)){static get properties(){return{action:{type:String},currency:{type:Object},error:{type:Boolean,reflect:!0},icon:{type:String},name:{type:String},sections:{type:Array},_size:{type:String},_state:{type:Object}}}constructor(){super(),this.action="add",this.currency=I,this.error=!1,this._simulator=new y,this._state={}}onResize({width:t}){this._size=t}_getTitle(t){switch(t){case"storage":return"Storage:";case"inbound-traffic":return"Inbound traffic:";case"outbound-traffic":return"Outbound traffic:";case"private-users":return"Private users:";case"public-users":return"Public users:";case"total":return"Estimated total (30 days):"}}_getLabel(t){switch(t){case"storage":return"storage";case"inbound-traffic":return"traffic in";case"outbound-traffic":return"traffic out";case"private-users":return"private users";case"public-users":return"public users"}}_getCurrencyValue(t){return{price:t*this.currency.changeRate,code:this.currency.code}}_getUnits(){return[{label:v({bytes:1e6}),value:"1000000"},{label:v({bytes:1e9}),value:"1000000000"},{label:v({bytes:1e12}),value:"1000000000000"}]}_isTypeBytes(t){return["storage","inbound-traffic","outbound-traffic"].includes(t)}_getMinRange(t,e){return this._isTypeBytes(t)?h({bytes:e}):e}_getMaxRange(t,e){return null==e?"âˆž":this._isTypeBytes(t)?h({bytes:e}):e}_getIntervalPrice(t,i){return 0===i?"FREE":this._isTypeBytes(t)?(({price:t,code:i})=>`${e("en",t,{minimumFractionDigits:3,maximumFractionDigits:3,currency:i})} / ${g(1e9)} (30 days)`)(this._getCurrencyValue(1e9*i)):(({userCount:t,price:i,code:n})=>{const s=m(t,"user");return`${e("en",i*t,{currency:n})} / ${t} ${s} (30 days)`})({...this._getCurrencyValue(i),userCount:this.sections.find((e=>e.type===t)).secability??1})}_updateSimulatorQuantity(t){const e=this._state[t].quantity,i=this._isTypeBytes(t)?parseInt(this._state[t].unitValue):1;this._simulator.setQuantity(t,e*i)}_onToggleState(t){this._state[t].isClosed=!this._state[t].isClosed,this.requestUpdate()}_onInputValue(t,e){this._state[t].quantity=isNaN(e)?0:e,this._updateSimulatorQuantity(t),this.requestUpdate()}_onToggleUnit(t,e){this._state[t].unitValue=e,this._updateSimulatorQuantity(t),this.requestUpdate()}_onAddPlan(){const e=(this.sections??[]).map((({type:e})=>`${this._getTitle(e)} ${this._isTypeBytes(e)?h({bytes:this._simulator.getQuantity(e)}):(({number:e})=>t("en",e))({number:this._simulator.getQuantity(e)})}`)).join(", "),i={productName:this.name,name:e,price:this._simulator.getTotalPrice()/720};r(this,"cc-pricing-product:add-plan",i)}update(t){t.has("sections")&&Array.isArray(this.sections)&&(this._state={},this.sections.forEach((({type:t})=>{this._state[t]={isClosed:!0,quantity:0,unitValue:this._getUnits()[0].value}})),this._simulator=new y(this.sections)),super.update(t)}render(){const t=this.sections?.some((({intervals:t})=>null==t))??!0,e=this.sections?.map((({type:t})=>this._simulator.getQuantity(t)))?.every((t=>0===t))??!0,i=this.name??"??????????",n={"body--big":this._size>600,"body--small":this._size<=600};return a`<slot name=head><div class=head><div class=head-info><cc-img class=product-logo src=${l(this.icon)} ?skeleton=${null==this.icon}></cc-img><div class=name-wrapper><span class="${c({skeleton:null==this.name})} name">${i}</span></div></div>${this.error?"":a`<slot></slot>`}</div><hr></slot><div class="${c(n)} body">${this.error&&null==this.sections?a`<cc-error class=error-global>An error occured while retrieving pricing details.</cc-error><hr>`:""} ${this.sections?.map((t=>a`${this._renderSection(t)}<hr>`))}<div class=section><div class=section-header><cc-img class=section-icon src=${R}></cc-img><div class="section-title section-title--total"><div class=section-title-text>${this._getTitle("total")}</div><div class=section-title-price>${b(this._getCurrencyValue(this._simulator.getTotalPrice()))}</div></div></div></div><hr class=${c({last:"none"===this.action})}>${"add"===this.action?a`<div class=button-bar><cc-button image=${w} ?disabled=${t||e} @cc-button:click=${this._onAddPlan}>Add</cc-button></div>`:""}</div>`}_renderSection(t){const e=null==t.intervals,i=t.intervals??T,n=t.progressive,s=t.type,r=L[s],{isClosed:l,quantity:o,unitValue:u}=this._state[s],d=this._simulator.getSectionPrice(s),m=this._simulator.getMaxInterval(s);return a`<div class="${c({"section--closed":l})} section"><div class=section-header><cc-img class=section-icon src=${r}></cc-img><div class=section-title>${this._getTitle(s)}</div><cc-button class=section-toggle-btn image=${l?$:U} ?disabled=${e} hide-text circle @cc-button:click=${()=>this._onToggleState(s)}></cc-button></div><div class=input-wrapper>${this._renderInput({type:s,quantity:o,unitValue:u,skeleton:e})}</div>${this._renderIntervals({type:s,progressive:n,intervals:i,maxInterval:m,skeleton:e})} ${this.error?"":a`<div class="section-title section-title--subtotal"><div class=section-title-text>Subtotal (30 days):</div><div class=section-title-price><span class=${c({skeleton:e})}>${b(this._getCurrencyValue(d))}</span></div></div>`}</div>`}_renderInput({type:t,quantity:e,unitValue:i,skeleton:n}){return this._isTypeBytes(t)?a`<cc-input-number class=input-quantity value=${e} min=0 ?disabled=${n} @cc-input-number:input=${e=>this._onInputValue(t,e.detail)}></cc-input-number><cc-toggle class=input-unit value=${i} .choices=${this._getUnits()} ?disabled=${n} @cc-toggle:input=${e=>this._onToggleUnit(t,e.detail)}></cc-toggle>`:a`<cc-input-number class=input-quantity value=${e} min=0 ?disabled=${n} @cc-input-number:input=${e=>this._onInputValue(t,e.detail)}></cc-input-number>`}_renderIntervals({type:t,progressive:e,intervals:i,maxInterval:n,skeleton:s}){return this.error?a`<cc-error>An error occured while retrieving pricing details.</cc-error>`:i.map(((r,l)=>{const o=i.indexOf(n),u=r===n||e&&l<=o,d=this._getMinRange(t,r.minRange),m=this._getMaxRange(t,r.maxRange),p=this._getIntervalPrice(t,r.price),g=this._simulator.getIntervalPrice(t,l),h=b(this._getCurrencyValue(g));return a`<div class="${c({progressive:e,highlighted:u})} interval-line"><div class="interval interval-min"><span class=${c({skeleton:s})}>${d}</span></div><div class="interval interval-min-sign">&le;</div><div class="interval interval-label">${this._getLabel(t)}</div><div class="interval interval-max-sign">&lt;</div><div class="interval interval-max"><span class=${c({skeleton:s})}>${m}</span></div><div class="${c({"interval-price--free":0===r.price})} interval-price"><span class=${c({skeleton:s})}>${p}</span></div><div class=estimated-price><span class=${c({skeleton:s})}>${h}</span></div></div>`}))}static get styles(){return[o,u`:host{background-color:#fff;display:block}:host([error]){--cc-skeleton-state:paused}.head{border-radius:.25em;display:grid;gap:1em;grid-auto-rows:min-content;padding:1em 1em 0}.head-info{display:flex;flex-wrap:wrap;gap:0;margin:-.5em}.name-wrapper,.product-logo,slot[name=icon]::slotted(*){margin:.5em}.product-logo,slot[name=icon]::slotted(*){--cc-img-fit:contain;border-radius:.25em;display:block;height:3em;width:3em}.name-wrapper{align-self:center;font-weight:700}.name{font-size:1.5em}.description{line-height:1.5}.body{align-items:center;display:grid;overflow:visible;white-space:nowrap}.interval-line,.section,.section-header{display:contents}hr{border-color:#e5e5e5;border-style:solid;border-width:1px 0 0;grid-column:1/-1;margin:1em 0;width:100%}hr.last{margin-bottom:0}.section-icon{grid-column:section-icon/span 1;height:1em;margin-right:1em;width:1em}.section-title{display:flex;font-weight:700;grid-column:title/title--end;justify-content:space-between}.section-title.section-title--subtotal,.section-title.section-title--total{grid-column:title/title-total--end}.section-title.section-title--subtotal{margin-top:.5em}.section-title.section-title--subtotal .section-title-text{font-weight:400}.section-title-price{margin-left:1em}.input-wrapper{align-items:end;display:flex;grid-column:input-wrapper/input-wrapper--end;margin:1em 0;width:100%}.input-quantity{flex:1 1 0;min-width:10ch}.input-unit{--cc-text-transform:none;margin-left:.5em}cc-error{grid-column:interval-min/end;line-height:1.5;white-space:normal}cc-error.error-global{grid-column:start/end}.interval-line{--bdrs:5px}.estimated-price,.interval,.interval-price{align-self:stretch;margin:.1em 0;padding-left:.25em;padding-top:.15em}.interval,.interval-price{padding-bottom:.15em;padding-right:.25em}.interval-line.highlighted:not(.progressive) .interval{background-color:rgba(50,50,255,.15)}.interval-max,.interval-min,.interval-price{text-align:right}.interval-min{border-radius:var(--bdrs) 0 0 var(--bdrs);grid-column:interval-min/span 1}.interval-label{text-align:center}.interval-price{color:#333;font-style:italic;grid-column:interval-price/interval-price--end}.interval-max{border-radius:0 var(--bdrs) var(--bdrs) 0}.estimated-price{font-weight:700;text-align:right}.interval-line:not(.highlighted) .estimated-price{visibility:hidden}.button-bar{grid-column:start/end;margin-bottom:1em}.skeleton{background-color:#bbb}.body--big{grid-template-columns:1em [start section-icon] 2em [title input-wrapper interval-min] min-content [interval-min-sign] min-content [interval-label] min-content [interval-max-sign] min-content [interval-max] min-content [interval-price input-wrapper--end] min-content [estimated-price interval-price--end] min-content [title--end title-total--end] 1fr [end] 1em}.body--big .section-title--subtotal,.body--big .section-toggle-btn{display:none}.body--big .interval-label{text-align:center}.body--big .interval-price{margin-left:2em}.body--big .estimated-price{grid-column:estimated-price/span 1;margin-left:2em}.body--small{grid-template-columns:1em [start section-icon] 2em [title input-wrapper interval-min interval-price] min-content [interval-min-sign] min-content [interval-label] min-content [interval-max-sign] min-content [interval-max toggle-btn title--end] min-content [input-wrapper--end interval-price--end title-total--end] 1fr [end] 1em}.body--small .section-toggle-btn{grid-column:toggle-btn/end;justify-self:end}.body--small .section--closed .input-wrapper{margin-bottom:.5em}.body--small .section--closed .interval,.body--small .section--closed .interval-price{height:0;margin-bottom:0;margin-top:0;padding-bottom:0;padding-top:0;visibility:hidden}.body--small .interval-price{margin-bottom:1em}.body--small .estimated-price{display:none}`]}}window.customElements.define("cc-pricing-product-consumption",q);export{q as CcPricingProductConsumption};
